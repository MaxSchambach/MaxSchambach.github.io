{% assign current_year = 0 %}

{% for post in site.posts %}
    {% if post.categories contains 'theses'
    or post.categories contains 'journal'
    or post.categories contains 'conference'
    or post.categories contains 'dataset'
    or post.categories contains 'software'
    %}
        {% capture post_year %}{{ post.date | date: "%Y" }}{% endcapture %}
        {% if post_year != current_year %}
            {% assign current_year = post_year %}
            {% if current_year != 0 %}
                </ul></div>
            {% endif %}
            <h2>{{ post_year }}</h2>
            <div class="publication-list"><ul>
         {% endif %}
        {% if post.categories contains 'theses' %}
            <li>
                <a href="{{ post.url | prepend: site.baseurl }}">{{ post.title }}.</a><br>
                {{ post.ref-authors }}<br>
                {{ post.ref-thesis }}{% if post.ref-year %}, {{ post.ref-year }}{% endif %}.<br>
                {% if post.ref-link %}
                <a target="_blank" href="{{ post.ref-link }}" >[thesis]</a>
                {% endif %}
                {% if post.ref-code %}
                <a target="_blank" href="{{ post.ref-code }}">[code]</a>
                {% endif %}
                {% if post.ref-data %}
                <a target="_blank" href="{{ post.ref-data }}">[data]</a>
                {% endif %}
            </li>
        {% endif %}
        {% if post.categories contains 'journal' %}
            <li>
                <a href="{{ post.url | prepend: site.baseurl }}">{{ post.title }}.</a><br>
                {{ post.ref-authors }}<br>
                <i>{{ post.ref-journal }}</i>{% if post.ref-volume %}, <b>{{ post.ref-volume }}</b>{% if post.ref-issue %}.{{ post.ref-issue }}{% endif %}{% endif %}{% if post.ref-pages %}, pp.{{ post.ref-pages }}{% endif %}{% if post.ref-year %}, {{ post.ref-year }}{% endif %}.<br>
                {% if post.ref-link %}
                <a target="_blank" href="{{ post.ref-link }}">[paper]</a>
                {% endif %}
                {% if post.ref-code %}
                <a target="_blank" href="{{ post.ref-code }}">[code]</a>
                {% endif %}
                {% if post.ref-data %}
                <a target="_blank" href="{{ post.ref-data }}">[data]</a>
                {% endif %}
            </li>
        {% endif %}
        {% if post.categories contains 'conference' %}
            <li>
                <a href="{{ post.url | prepend: site.baseurl }}">{{ post.title }}.</a><br>
                {{ post.ref-authors }}<br>
                {{ post.ref-conference }}{% if post.ref-organizer %}<br>{{ post.ref-organizer }}{% endif %}{% if post.ref-year %}, {{ post.ref-year }}{% endif %}.<br>
                {% if post.ref-link %}
                <a target="_blank" href="{{ post.ref-link }}">[paper]</a>
                {% endif %}
                {% if post.ref-code %}
                <a target="_blank" href="{{ post.ref-code }}">[code]</a>
                {% endif %}
                {% if post.ref-data %}
                <a target="_blank" href="{{ post.ref-data }}">[data]</a>
                {% endif %}
            </li>
        {% endif %}
        {% if post.categories contains 'dataset' %}
            <li>
                <a href="{{ post.url | prepend: site.baseurl }}">{{ post.title }}.</a><br>
                {{ post.ref-authors }}<br>
                {{ post.ref-reference }}{% if post.ref-year %}, {{ post.ref-year }}{% endif %}.<br>
                {% if post.ref-link %}
                <a target="_blank" href="{{ post.ref-link }}" >[paper]</a>
                {% endif %}
                {% if post.ref-code %}
                <a target="_blank" href="{{ post.ref-code }}">[code]</a>
                {% endif %}
                {% if post.ref-data %}
                <a target="_blank" href="{{ post.ref-data }}">[data]</a>
                {% endif %}
            </li>
        {% endif %}
        {% if post.categories contains 'software' %}
            <li>
                <a href="{{ post.link }}">{{ post.title }}.</a><br>
                {{ post.ref-details }}<br>
            </li>
        {% endif %}
    {% endif %}
{% endfor %}
</ul></div>